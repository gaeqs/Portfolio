---
import {Star} from "@lucide/astro";
import SkeletonImage from "../ui/SkeletonImage.astro";

interface Props {
  title: string;
  description: string;
  url: string;
  languages: string[];
  image?: { url: string; alt: string };
  isFeatured?: boolean;
}

const {title, description, url, languages, image, isFeatured = false} = Astro.props;

// LÃ³gica de colores (Igual que antes)
const getTheme = (tags: string[]) => {
  const t = tags.join(" ").toLowerCase();
    if (t.includes("c-sharp") || t.includes("unity") || t.includes("cuda")) return {
        text: "text-green-400",
        border: "border-green-500/30",
        bg: "from-green-600/20 to-green-900/40",
        dot: "bg-green-500"
    };
  if (t.includes("c++") || t.includes("cpp")) return {
    text: "text-blue-400",
    border: "border-blue-500/30",
    bg: "from-blue-600/20 to-blue-900/40",
    dot: "bg-blue-500"
  };
  if (t.includes("rust")) return {
    text: "text-orange-400",
    border: "border-orange-500/30",
    bg: "from-orange-600/20 to-orange-900/40",
    dot: "bg-orange-500"
  };
  if (t.includes("java") || t.includes("kotlin")) return {
    text: "text-red-400",
    border: "border-red-500/30",
    bg: "from-red-600/20 to-red-900/40",
    dot: "bg-red-500"
  };
  if (t.includes("js") || t.includes("ts") || t.includes("web") || t.includes("astro")) return {
    text: "text-yellow-400",
    border: "border-yellow-500/30",
    bg: "from-yellow-600/20 to-yellow-900/40",
    dot: "bg-yellow-500"
  };
  return {
    text: "text-zinc-400",
    border: "border-zinc-600/30",
    bg: "from-zinc-700/20 to-zinc-900/40",
    dot: "bg-zinc-500"
  };
};

const theme = getTheme(languages || []);
---

<a href={url} class="group block w-full h-full relative transition-all duration-300 hover:-translate-y-1">

  {isFeatured && (
          <div class="absolute -inset-[2px] bg-gradient-to-r from-cyan-500/30 via-purple-500/30 to-cyan-500/30 rounded-xl blur-md opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none z-0"></div>
  )}

  <article
          class={`relative h-full flex flex-col overflow-hidden rounded-md border bg-zinc-900/50 backdrop-blur-sm transition-all duration-300 hover:shadow-2xl z-10
          ${isFeatured ? 'border-cyan-500/40' : 'border-white/10 hover:border-cyan-500/50 hover:shadow-[0_0_15px_rgba(6,182,212,0.15)]'}`}
  >

    {isFeatured && (
            <div class="absolute top-4 right-4 z-30 flex items-center gap-1.5 px-2.5 py-1 bg-zinc-950/90 backdrop-blur-md border border-yellow-500/40 rounded text-[10px] font-mono text-yellow-400 shadow-[0_0_5px_rgba(234,179,8,0.2)]">
              <Star width="12" height="12" fill="currentColor"/>
              <span>STARRED</span>
            </div>
    )}

    <div class="relative w-full h-64 overflow-hidden border-b border-white/10 bg-zinc-950 group/header">
      {image ? (
              <div class="relative w-full h-full">
                <SkeletonImage
                        src={image.url}
                        alt={image.alt || title}
                        class="w-full h-full object-cover transition-all duration-700 group-hover:scale-105 relative z-10"
                        loading="lazy"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-zinc-900/80 via-transparent to-transparent opacity-60 pointer-events-none z-20"></div>
              </div>
      ) : (
              <div class={`w-full h-full relative flex flex-col items-center justify-center bg-gradient-to-br ${theme.bg}`}>
                <div class="absolute inset-0 bg-[linear-gradient(to_right,#ffffff05_1px,transparent_1px),linear-gradient(to_bottom,#ffffff05_1px,transparent_1px)] bg-[size:16px_16px] z-0"></div>
                <div class="absolute inset-0 bg-black/20 z-2"></div>
                <div class={`relative z-10 text-center border-2 ${theme.border} max-w-4/5 px-6 py-3 rounded-lg backdrop-blur-sm bg-black/30 shadow-lg`}>
                  <h3 class={`text-3xl font-black tracking-tighter ${theme.text} uppercase font-mono`}>
                    {title}
                  </h3>
                  <div class="mt-2 flex justify-center gap-1.5 opacity-80">
                    <span class={`h-1.5 w-1.5 rounded-sm ${theme.dot}`}> </span>
                    <span class={`h-1.5 w-1.5 rounded-sm ${theme.dot}`}> </span>
                    <span class={`h-1.5 w-1.5 rounded-sm ${theme.dot}`}> </span>
                  </div>
                </div>
                <div class="absolute bottom-3 right-3 font-mono text-[9px] text-white/40 border border-white/10 px-2 py-1 rounded-sm bg-black/40 z-10 flex items-center gap-2">
                  <span class={`w-1.5 h-1.5 rounded-full ${theme.dot}`}></span>
                  LIB :: {languages[0]?.toUpperCase() || "CORE"}
                </div>
              </div>
      )}
    </div>

    <div class="flex flex-col p-5 gap-4 flex-grow relative z-20 bg-zinc-900/90">
      <div class="flex flex-col gap-2">
        <h2 class="text-xl font-sans font-bold text-zinc-100 tracking-tight group-hover:text-cyan-400 transition-colors">
          {title}
        </h2>
        <p class="text-sm text-zinc-400 leading-relaxed line-clamp-3">
          {description}
        </p>
      </div>

      <div class="mt-auto pt-4 border-t border-white/5">
        <div class="flex flex-wrap gap-2">
          {languages.map((language: string) => (
                  <span class="font-mono text-[10px] uppercase tracking-wider text-cyan-400 px-2 py-1 rounded-sm border border-cyan-500/20 bg-cyan-500/5 group-hover:bg-cyan-500/10 transition-colors">
                    {language}
                </span>
          ))}
        </div>
      </div>
    </div>
  </article>
</a>