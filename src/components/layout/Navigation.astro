---
const { items } = Astro.props;

const baseClasses = {
  nav: "nav-links flex items-center gap-1 max-md:hidden",
  link: "px-3 py-1.5 text-sm font-medium text-zinc-400 hover:text-white hover:bg-white/5 rounded-md transition-all duration-200",
  active: "text-cyan-400 bg-cyan-500/10 hover:bg-cyan-500/20",
  mobileNav: "fixed top-[60px] left-0 w-full bg-zinc-950/95 backdrop-blur-xl border-b border-white/10 p-6 flex flex-col gap-4 md:hidden transform transition-transform duration-300 origin-top scale-y-0 opacity-0",
  mobileNavOpen: "scale-y-100 opacity-100",
  mobileLink: "text-lg font-medium text-zinc-400 hover:text-cyan-400 py-2 border-b border-white/5"
};
---

<nav class={baseClasses.nav}>
  {
    items.map((item: string) => (
      <a
        href={item === "home" ? "/#" : `/#${item}`}
        class={baseClasses.link}
        data-nav-link
      >
        {item.charAt(0).toUpperCase() + item.slice(1)}
      </a>
    ))
  }
</nav>

<!-- Mobile Navigation Overlay -->
<div id="mobile-menu" class={baseClasses.mobileNav}>
  {
    items.map((item: string) => (
      <a
        href={item === "home" ? "/" : `/#${item}`}
        class={baseClasses.mobileLink}
        data-nav-link
      >
        {item.charAt(0).toUpperCase() + item.slice(1)}
      </a>
    ))
  }
</div>

<script>
  // Active Link Logic (Scrollspy)
  const sections = document.querySelectorAll("section");
  const navLinks = document.querySelectorAll("[data-nav-link]");

  const observerOptions = {
    root: null,
    rootMargin: "-20% 0px -80% 0px", // Trigger when section is near top
    threshold: 0
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute("id");
        navLinks.forEach((link) => {
          const href = link.getAttribute("href");
          if (href === `/#${id}` || (id === 'hero' && href === '/')) {
            link.classList.add("text-cyan-400", "bg-cyan-500/10");
            link.classList.remove("text-zinc-400");
          } else {
            link.classList.remove("text-cyan-400", "bg-cyan-500/10");
            link.classList.add("text-zinc-400");
          }
        });
      }
    });
  }, observerOptions);

  sections.forEach((section) => observer.observe(section));

  // Mobile Menu Logic
  const hamburger = document.querySelector(".hamburger");
  const mobileMenu = document.getElementById("mobile-menu");
  const barsIcon = document.querySelector(".bars-icon");
  const xmarkIcon = document.querySelector(".xmark-icon");

  if (hamburger && mobileMenu && barsIcon && xmarkIcon) {
    xmarkIcon.classList.add("hidden");

    hamburger.addEventListener("click", () => {
      const isExpanded = hamburger.getAttribute("aria-expanded") === "true";
      hamburger.setAttribute("aria-expanded", (!isExpanded).toString());
      
      mobileMenu.classList.toggle("scale-y-100");
      mobileMenu.classList.toggle("opacity-100");
      
      barsIcon.classList.toggle("hidden");
      xmarkIcon.classList.toggle("hidden");
    });

    // Close menu when clicking a link
    mobileMenu.querySelectorAll("a").forEach(link => {
      link.addEventListener("click", () => {
        hamburger.setAttribute("aria-expanded", "false");
        mobileMenu.classList.remove("scale-y-100", "opacity-100");
        barsIcon.classList.remove("hidden");
        xmarkIcon.classList.add("hidden");
      });
    });
  }
</script>
