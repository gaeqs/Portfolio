---
import Navigation from "./Navigation.astro";
import Social from "../ui/Social.astro";
import {Icon} from "astro-icon/components";
import {AstroError} from "astro/errors";
import {getCollection} from "astro:content";

const [staticData] = await getCollection('staticData');

if (!staticData) {
  throw new AstroError("JSON data not found");
}

const currentPath = Astro.url.pathname;
const routes = ["/", "/portfolio", "/about-me",];

// Check if the current route is in the list of routes
const isActiveRoute = routes.includes(currentPath);

const navItems =
  ["home", "projects", "experience" /*, "about", "blog"*/]
---

<header
  role="banner"
  aria-label="Main navigation"
  class="fixed top-0 left-0 w-full z-50 bg-zinc-950/80 backdrop-blur-md border-b border-white/5 transition-all"
>
  <div
    class="relative mx-auto flex max-w-7xl flex-row items-center justify-between px-6 py-3"
  >
    <!-- Logo (Left) -->
    <a href="/" aria-label="Go to home" class="flex items-center gap-1 group">
      <span class="font-mono text-sm font-bold text-zinc-100 tracking-tighter">GAEL.RIAL</span>
      <span class="w-2 h-4 bg-cyan-500 animate-pulse"></span>
    </a>

    <!-- Navigation (Center/Right) -->
    <Navigation items={navItems} />

    <!-- Socials (Far Right) -->
    <div class="flex items-center gap-4 text-xl md:pl-5 border-l border-white/10 ml-5 pl-5">
      <div class="max-md:hidden flex items-center justify-center gap-4" role="list">
        <Social link={staticData.data.github} iconName={staticData.data.githubIconName} />
        <Social link={staticData.data.linkedin} iconName={staticData.data.linkedinIconName} />
      </div>
      
      <!-- Mobile Menu Button -->
      <button
        class="hamburger p-1 rounded-md hover:bg-white/5 transition-colors text-zinc-400 hover:text-cyan-400 md:hidden"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <Icon name="bars" class="hamburger-icon bars-icon w-5 h-5" aria-hidden="true" />
        <Icon name="xmark" class="hamburger-icon xmark-icon w-5 h-5" aria-hidden="true" />
      </button>
    </div>
  </div>

  <!-- Scroll Progress Bar -->
  <div class="absolute bottom-0 left-0 h-[1px] bg-gradient-to-r from-cyan-500 to-blue-500 transition-all duration-100 ease-out w-0" id="scrollProgress"></div>
</header>

<script>
  // Scroll Progress Logic
  const scrollProgress = document.getElementById('scrollProgress');
  
  const updateScrollProgress = () => {
    if (!scrollProgress) return;
    const scrollTop = window.scrollY || document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrollPercent = (scrollTop / scrollHeight) * 100;
    scrollProgress.style.width = `${scrollPercent}%`;
  };

  window.addEventListener('scroll', updateScrollProgress);
  window.addEventListener('resize', updateScrollProgress);
</script>
