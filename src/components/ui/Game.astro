---
interface Props {
  src: string;
  poster: string;
  title?: string;
  height?: string;
}

const {src, poster, title = "Playable Demo", height = "aspect-video"} = Astro.props;
---

<div class="my-12 not-prose">
  <div class="relative w-full rounded-xl overflow-hidden border border-white/10 bg-zinc-900 shadow-2xl group game-wrapper">

    <div class="flex items-center justify-between px-4 py-2 bg-zinc-950/80 border-b border-white/5 backdrop-blur">
      <div class="flex items-center gap-2">
        <div class="flex gap-1.5">
          <div class="w-2.5 h-2.5 rounded-full bg-red-500/20"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/20"></div>
          <div class="w-2.5 h-2.5 rounded-full bg-green-500/20"></div>
        </div>
        <span class="text-xs font-mono text-zinc-500 ml-2 uppercase tracking-wider">{title}</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="text-[10px] font-mono text-zinc-600">WEBGL CONTEXT</div>
        <button
                class="fullscreen-btn text-zinc-500 hover:text-cyan-400 transition-colors focus:outline-none p-1 rounded hover:bg-white/5"
                aria-label="Toggle Fullscreen"
                title="Fullscreen Mode"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
          </svg>
        </button>
      </div>
    </div>
    <div
            class={`relative w-full ${height} bg-zinc-950 game-container`}
            data-src={src}
    >
      <div class="poster absolute inset-0 z-10 flex items-center justify-center bg-cover bg-center transition-all duration-500"
           style={`background-image: url('${poster}');`}>
        <div class="absolute inset-0 bg-black/60 backdrop-blur-[2px] group-hover:backdrop-blur-none transition-all"></div>

        <button class="play-btn relative z-20 flex flex-col items-center gap-4 group/btn bg-zinc-900/80 rounded">
          <span class="font-mono text-sm text-cyan-400 font-bold uppercase tracking-widest px-3 py-1 rounded border border-cyan-500/30">
            Click to Run
          </span>
        </button>
      </div>

    </div>
  </div>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const wrappers = document.querySelectorAll('.game-wrapper');

    wrappers.forEach(wrapper => {
      const container = wrapper.querySelector('.game-container') as HTMLElement;
      const playBtn = wrapper.querySelector('.play-btn');
      const poster = wrapper.querySelector('.poster');
      const fsBtn = wrapper.querySelector('.fullscreen-btn');
      const src = container.getAttribute('data-src');

      playBtn?.addEventListener('click', () => {
        if (!src) return;
        const iframe = document.createElement('iframe');
        iframe.src = src;
        iframe.className = "absolute inset-0 w-full h-full border-0";
        iframe.allow = "autoplay; fullscreen; focus-without-user-activation";
        iframe.setAttribute('tabindex', '0');

        poster?.classList.add('opacity-0', 'pointer-events-none');
        container.appendChild(iframe);
        setTimeout(() => iframe.focus(), 100);
      });

      fsBtn?.addEventListener('click', () => {
        if (!document.fullscreenElement) {
          container.requestFullscreen().catch(err => {
            console.error(`Error attempting to enable fullscreen: ${err.message}`);
          });
        } else {
          document.exitFullscreen();
        }
      });
    });
  });
</script>